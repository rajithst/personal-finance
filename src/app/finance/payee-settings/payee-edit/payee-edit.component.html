<h2 mat-dialog-title>
  <span>{{ data.payee.destination }}</span>
</h2>
<mat-dialog-content>
  <form [formGroup]="payeeForm">
    <table class="expense-field-table">
      <tr>
        <td>
          <mat-form-field appearance="outline" class="payee-input">
            <mat-label>Payee</mat-label>
            <input
              matInput
              readonly
              placeholder="Payee"
              formControlName="destination_original"
            />
          </mat-form-field>
        </td>
        <td colspan="2">
          <mat-form-field appearance="outline" class="payee-input">
            <mat-label>Payee Rename to</mat-label>
            <input matInput placeholder="Payee" formControlName="destination" />
          </mat-form-field>
        </td>
      </tr>
      <tr>
        <td>
          <mat-form-field appearance="outline" class="payee-input">
            <mat-label>Category</mat-label>
            <mat-select formControlName="category">
              @for (exc of this.TRANSACTION_CATEGORIES; track exc) {
                <mat-option [value]="exc.id">{{ exc.category }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        </td>
        <td>
          <mat-form-field appearance="outline" class="fill payee-input">
            <mat-label>Sub Category</mat-label>
            <mat-select formControlName="subcategory">
              @for (exc of this.EXPENSE_SUB_CATEGORIES; track exc) {
                <mat-option [value]="exc.id">{{ exc.name }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        </td>
        <td>
          <mat-form-field appearance="outline" class="payee-input">
            <mat-label>Payee Alias (English)</mat-label>
            <input
              matInput
              placeholder="Destination"
              formControlName="destination_eng"
            />
          </mat-form-field>
        </td>
      </tr>
    </table>
  </form>
  <mat-divider></mat-divider>
  <div class="payee-rules">
    <div class="rule-title">
      <span
        >If Payee name contains below keywords, map to
        {{ payeeForm.get("destination")?.value }}. (Current and Future
        transactions)</span
      >
    </div>
    <mat-form-field class="keyword-chip-list">
      <mat-label>Keywords</mat-label>
      <mat-chip-grid #chipGrid aria-label="Enter fruits">
        @for (akaChip of keywords; track akaChip) {
          <mat-chip-row
            (removed)="remove(akaChip)"
            [editable]="true"
            (edited)="edit(akaChip, $event)"
            [aria-description]="'press enter to edit ' + akaChip"
          >
            {{ akaChip }}
            <button matChipRemove [attr.aria-label]="'remove ' + akaChip">
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip-row>
        }
        <input
          placeholder="New keyword..."
          [matChipInputFor]="chipGrid"
          [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
          [matChipInputAddOnBlur]="addOnBlur"
          (matChipInputTokenEnd)="add($event)"
        />
      </mat-chip-grid>
    </mat-form-field>
  </div>
  <div class="related-payees" *ngIf="dataSource.data.length > 0">
    <mat-divider></mat-divider>
    <div class="related-payees-header">
      <h3>
        Found similar payees for above keywords. Do you want to merge them all?
      </h3>
    </div>
    <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">
      <ng-container matColumnDef="select">
        <th mat-header-cell *matHeaderCellDef>
          <mat-checkbox
            (change)="$event ? toggleAllRows() : null"
            [checked]="selection.hasValue() && isAllSelected()"
            [indeterminate]="selection.hasValue() && !isAllSelected()"
          >
          </mat-checkbox>
        </th>
        <td mat-cell *matCellDef="let row">
          <mat-checkbox
            (click)="$event.stopPropagation()"
            (change)="$event ? selection.toggle(row) : null"
            [checked]="selection.isSelected(row)"
          >
          </mat-checkbox>
        </td>
      </ng-container>

      <ng-container matColumnDef="Payee">
        <th mat-header-cell *matHeaderCellDef>Payee</th>
        <td mat-cell *matCellDef="let element">
          {{ element.destination_original }}
        </td>
      </ng-container>

      <!-- Weight Column -->
      <ng-container matColumnDef="Category">
        <th mat-header-cell *matHeaderCellDef>Category</th>
        <td mat-cell *matCellDef="let element">{{ element.category_text }}</td>
      </ng-container>

      <!-- Symbol Column -->
      <ng-container matColumnDef="SubCategory">
        <th mat-header-cell *matHeaderCellDef>Sub Category</th>
        <td mat-cell *matCellDef="let element">
          {{ element.subcategory_text }}
        </td>
      </ng-container>
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" [attr.colspan]="displayedColumns.length">
          No matching/duplicate payees.
        </td>
      </tr>
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>
</mat-dialog-content>

<mat-dialog-actions align="end" class="expense-form-footer">
  <button mat-raised-button mat-dialog-close (click)="cancel()">Cancel</button>
  <button mat-raised-button color="primary" (click)="submit()">Save</button>
</mat-dialog-actions>
